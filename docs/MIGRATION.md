# Migration from Rust alvan-lic

## üîÑ Quick Migration Guide

The Node.js version is **100% compatible** with the Rust version. License keys generated by either version can be validated by the other.

## API Mapping

### Rust ‚Üí Node.js

| Rust | Node.js |
|------|---------|
| `LicenseGenerator::new(secret)` | `new LicenseGenerator(secret)` |
| `generator.generate_key(hours)` | `generator.generateKey(hours)` |
| `LicenseValidator::new(secret)` | `new LicenseValidator(secret)` |
| `validator.validate_key(key)` | `validator.validateKey(key)` |
| `Result<T>` | `try/catch` with `LicenseError` |

### Code Examples

**Rust:**
```rust
use alvan_lic::{LicenseGenerator, LicenseValidator};

let generator = LicenseGenerator::new("secret");
let license = generator.generate_key(24).unwrap();

let validator = LicenseValidator::new("secret");
match validator.validate_key(&license) {
    Ok(info) => println!("Valid for {} hours", info.hours_remaining),
    Err(e) => println!("Invalid: {}", e),
}
```

**Node.js:**
```javascript
const { LicenseGenerator, LicenseValidator } = require('alvan-lic');

const generator = new LicenseGenerator('secret');
const license = generator.generateKey(24);

const validator = new LicenseValidator('secret');
try {
  const info = validator.validateKey(license);
  console.log(`Valid for ${info.hoursRemaining} hours`);
} catch (error) {
  console.log(`Invalid: ${error.message}`);
}
```

## Error Handling Migration

### Rust Error Types ‚Üí Node.js
| Rust | Node.js |
|------|---------|
| `LicenseError::InvalidFormat` | `LicenseErrorType.INVALID_FORMAT` |
| `LicenseError::InvalidSignature` | `LicenseErrorType.INVALID_SIGNATURE` |
| `LicenseError::Expired` | `LicenseErrorType.EXPIRED` |
| `LicenseError::InvalidData` | `LicenseErrorType.INVALID_DATA` |

**Rust:**
```rust
match validator.validate_key(&license) {
    Ok(info) => { /* success */ },
    Err(LicenseError::Expired) => { /* handle expiration */ },
    Err(LicenseError::InvalidSignature) => { /* handle tampering */ },
    Err(e) => { /* handle other errors */ },
}
```

**Node.js:**
```javascript
try {
  const info = validator.validateKey(license);
  // success
} catch (error) {
  if (error.type === 'EXPIRED') {
    // handle expiration
  } else if (error.type === 'INVALID_SIGNATURE') {
    // handle tampering  
  } else {
    // handle other errors
  }
}
```

## CLI Migration

### Command Mapping
| Rust CLI | Node.js CLI |
|----------|-------------|
| `cargo run --example cli_tool` | `npx alvan-cli` |
| `./generate_key secret 24` | `npx alvan-cli generate --secret secret --hours 24` |

### Installation
**Rust:**
```bash
cargo install alvan-lic
alvan-cli
```

**Node.js:**
```bash
npm install -g alvan-lic
alvan-cli
```

## Cross-Platform Compatibility

### License Format
- **Same prefix**: `alvan-`
- **Same encoding**: Base64URL (no padding)
- **Same signature**: HMAC-SHA256
- **Same payload**: `timestamp:timestamp.signature`

### Validation
```javascript
// License generated by Rust can be validated by Node.js
const rustGeneratedLicense = "alvan-MTcwNDQ2NzI4MjoxNzA0NTUzNjgy...";
const nodeValidator = new LicenseValidator('same-secret-key');
const info = nodeValidator.validateKey(rustGeneratedLicense); // ‚úÖ Works

// License generated by Node.js can be validated by Rust  
const nodeGeneratedLicense = nodeGenerator.generateKey(24);
// Rust validator with same secret will accept this license ‚úÖ
```

## Project Structure Migration

### Cargo.toml ‚Üí package.json
**Rust:**
```toml
[dependencies]
alvan-lic = "0.1.0"
```

**Node.js:**
```json
{
  "dependencies": {
    "alvan-lic": "^1.0.0"
  }
}
```

### Module Imports
**Rust:**
```rust
use alvan_lic::{LicenseGenerator, LicenseValidator, LicenseError};
```

**Node.js:**
```javascript
const { LicenseGenerator, LicenseValidator, LicenseError } = require('alvan-lic');
// or
import { LicenseGenerator, LicenseValidator, LicenseError } from 'alvan-lic';
```

## Testing Migration

### Test Framework
**Rust (similar tests):**
```rust
#[test]
fn test_license_workflow() {
    let generator = LicenseGenerator::new("test-secret");
    let validator = LicenseValidator::new("test-secret");
    
    let license = generator.generate_key(24).unwrap();
    let info = validator.validate_key(&license).unwrap();
    
    assert!(info.is_valid);
    assert!(info.hours_remaining > 0.0);
}
```

**Node.js:**
```javascript
test('license workflow', () => {
  const generator = new LicenseGenerator('test-secret');
  const validator = new LicenseValidator('test-secret');
  
  const license = generator.generateKey(24);
  const info = validator.validateKey(license);
  
  expect(info.isValid).toBe(true);
  expect(info.hoursRemaining).toBeGreaterThan(0);
});
```

## Environment Variables

Both versions use the same environment variable patterns:

```bash
# Works for both Rust and Node.js
LICENSE_SECRET=your-secret-key-here
```

## Performance Comparison

| Operation | Rust | Node.js |
|-----------|------|---------|
| Generate License | ~0.1ms | ~0.2ms |
| Validate License | ~0.1ms | ~0.2ms |
| Memory Usage | ~1MB | ~2MB |

## Migration Checklist

### Before Migration
- [ ] Document current Rust implementation
- [ ] Export any existing license keys for testing
- [ ] Note secret keys being used

### During Migration  
- [ ] Install Node.js version: `npm install alvan-lic`
- [ ] Replace Rust imports with Node.js imports
- [ ] Update error handling from `Result<T>` to `try/catch`
- [ ] Convert snake_case to camelCase method names
- [ ] Test with existing license keys

### After Migration
- [ ] Verify license compatibility with Rust version
- [ ] Update build/deployment scripts
- [ ] Update documentation and examples
- [ ] Train team on Node.js API differences

## Hybrid Usage

You can run both versions simultaneously:

```javascript
// Node.js service validates licenses generated by Rust CLI
const rustGeneratedLicense = process.env.RUST_CLI_LICENSE;
const nodeValidator = new LicenseValidator(process.env.SECRET_KEY);

try {
  const info = nodeValidator.validateKey(rustGeneratedLicense);
  console.log('‚úÖ Rust license valid in Node.js');
} catch (error) {
  console.log('‚ùå License validation failed');
}
```

## Common Migration Issues

### Issue: Method Name Differences
**Problem:** `generate_key` vs `generateKey`
**Solution:** Use camelCase for Node.js

### Issue: Error Handling
**Problem:** `Result<T>` vs exceptions
**Solution:** Wrap in try/catch blocks

### Issue: CLI Installation
**Problem:** Cargo vs NPM installation
**Solution:** Use `npx alvan-cli` or install globally

## Support

If you encounter migration issues:

1. Check license key compatibility with both versions
2. Verify secret keys are identical
3. Test with simple examples first
4. File issues on GitHub with both versions' outputs